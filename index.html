<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solo's Snacks - Stock-Based Financial System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://apis.google.com/js/api.js"></script>
    <style>
        /* ===== VARIABLES ===== */
        :root {
            --profit: #10B981;
            --profit-dark: #059669;
            --profit-light: #D1FAE5;
            --loss: #EF4444;
            --loss-dark: #DC2626;
            --loss-light: #FEE2E2;
            --primary: #111827;
            --secondary: #6B7280;
            --light: #F9FAFB;
            --white: #FFFFFF;
            --border: #E5E7EB;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
            --radius: 8px;
            --radius-lg: 12px;
            --warning: #F59E0B;
            --warning-light: #FEF3C7;
            --google-blue: #4285F4;
            --google-green: #34A853;
        }
        
        /* ===== RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Roboto', sans-serif;
            background-color: var(--light);
            color: var(--primary);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        /* ===== HEADER ===== */
        .main-header {
            background: linear-gradient(135deg, var(--profit) 0%, var(--profit-dark) 100%);
            color: white;
            padding: 25px 30px;
            border-radius: var(--radius-lg);
            margin-bottom: 30px;
            box-shadow: var(--shadow-lg);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .logo i {
            font-size: 2.8rem;
        }
        
        .logo h1 {
            font-family: 'Poppins', sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            margin-bottom: 5px;
        }
        
        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .header-stats {
            display: flex;
            gap: 30px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px 25px;
            border-radius: var(--radius);
            backdrop-filter: blur(10px);
        }
        
        .stat-item {
            text-align: center;
        }
        
        .stat-label {
            display: block;
            font-size: 0.9rem;
            opacity: 0.8;
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
        }
        
        .status-badge {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .status-badge.active {
            background-color: var(--profit);
            color: white;
        }
        
        /* ===== STATS GRID ===== */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: var(--white);
            padding: 25px;
            border-radius: var(--radius);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
            border-left: 4px solid var(--profit);
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            background: var(--profit-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--profit);
            font-size: 1.5rem;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .stat-title {
            color: var(--secondary);
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        /* ===== TABS ===== */
        .main-tabs {
            display: flex;
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            flex-wrap: wrap;
        }
        
        .tab-btn {
            flex: 1;
            min-width: 140px;
            padding: 18px 20px;
            background: none;
            border: none;
            border-bottom: 3px solid transparent;
            cursor: pointer;
            font-weight: 500;
            color: var(--secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .tab-btn:hover {
            background: var(--profit-light);
            color: var(--profit);
        }
        
        .tab-btn.active {
            border-bottom-color: var(--profit);
            color: var(--profit);
            background: var(--profit-light);
        }
        
        /* ===== TAB CONTENT ===== */
        .tab-content {
            display: none;
            animation: fadeIn 0.3s ease-in;
        }
        
        .tab-content.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ===== DASHBOARD ===== */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }
        
        .dashboard-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .dashboard-card h3 {
            color: var(--primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .summary-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .summary-item {
            padding: 15px;
            background: var(--light);
            border-radius: var(--radius);
        }
        
        .summary-label {
            font-size: 0.9rem;
            color: var(--secondary);
            margin-bottom: 5px;
        }
        
        .summary-value {
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .actions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }
        
        .action-btn {
            padding: 20px;
            background: var(--white);
            border: 2px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .action-btn:hover {
            border-color: var(--profit);
            background: var(--profit-light);
            transform: translateY(-2px);
        }
        
        .action-btn i {
            font-size: 1.8rem;
            color: var(--profit);
        }
        
        .action-btn span {
            font-weight: 500;
        }
        
        .activity-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .activity-item {
            padding: 15px;
            border-radius: var(--radius);
            border-left: 4px solid var(--border);
            display: flex;
            gap: 15px;
            align-items: flex-start;
        }
        
        .activity-item.profit {
            border-left-color: var(--profit);
            background: var(--profit-light);
        }
        
        .activity-item i {
            font-size: 1.2rem;
            color: var(--profit);
            margin-top: 2px;
        }
        
        .activity-content {
            flex: 1;
        }
        
        .activity-title {
            font-weight: 600;
            margin-bottom: 3px;
        }
        
        .activity-desc {
            font-size: 0.9rem;
            color: var(--secondary);
            margin-bottom: 3px;
        }
        
        .activity-time {
            font-size: 0.8rem;
            color: var(--secondary);
        }
        
        /* ===== FORMS ===== */
        .tab-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .tab-header h2 {
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .form-group {
            flex: 1;
            min-width: 250px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--primary);
        }
        
        input, select, textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--profit);
            box-shadow: 0 0 0 3px var(--profit-light);
        }
        
        /* ===== BUTTONS ===== */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: var(--radius);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background: #000;
        }
        
        .btn-success {
            background: var(--profit);
            color: white;
        }
        
        .btn-success:hover {
            background: var(--profit-dark);
        }
        
        .btn-danger {
            background: var(--loss);
            color: white;
        }
        
        .btn-danger:hover {
            background: var(--loss-dark);
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn-google {
            background: var(--google-blue);
            color: white;
        }
        
        .btn-google:hover {
            background: #3367D6;
        }
        
        .btn-sm {
            padding: 8px 15px;
            font-size: 0.9rem;
        }
        
        /* ===== TABLES ===== */
        .data-table {
            background: var(--white);
            border-radius: var(--radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }
        
        .table-header {
            padding: 20px 25px;
            background: var(--light);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .table-header h3 {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .table-actions {
            display: flex;
            gap: 10px;
        }
        
        .table-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
        }
        
        th {
            background: var(--light);
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
        }
        
        td {
            padding: 12px 15px;
            border-bottom: 1px solid var(--border);
        }
        
        tr:hover {
            background: var(--profit-light);
        }
        
        /* ===== STOCK TAKING ===== */
        .stock-controls {
            background: var(--white);
            padding: 20px;
            border-radius: var(--radius);
            margin-bottom: 25px;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            box-shadow: var(--shadow);
        }
        
        .control-group {
            flex: 1;
            min-width: 200px;
        }
        
        .stock-count-form {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .form-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .stock-items-container {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 25px;
        }
        
        .stock-item {
            display: flex;
            align-items: center;
            gap: 20px;
            padding: 15px;
            background: var(--light);
            border-radius: var(--radius);
            margin-bottom: 15px;
            border-left: 4px solid var(--profit);
        }
        
        .stock-item-info {
            flex: 1;
        }
        
        .stock-item-name {
            font-weight: 600;
            margin-bottom: 5px;
            color: var(--primary);
        }
        
        .stock-item-details {
            display: flex;
            gap: 20px;
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        .stock-item-input {
            width: 150px;
        }
        
        .stock-item-input input {
            text-align: center;
        }
        
        .stock-results {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        
        .result-card {
            padding: 20px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .result-card.profit {
            background: var(--profit-light);
            border-left: 4px solid var(--profit);
        }
        
        .result-card.loss {
            background: var(--loss-light);
            border-left: 4px solid var(--loss);
        }
        
        .result-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .result-card.profit .result-icon {
            color: var(--profit);
        }
        
        .result-card.loss .result-icon {
            color: var(--loss);
        }
        
        .result-value {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 3px;
        }
        
        .result-card.profit .result-value {
            color: var(--profit);
        }
        
        .result-card.loss .result-value {
            color: var(--loss);
        }
        
        .result-label {
            font-size: 0.9rem;
            color: var(--secondary);
        }
        
        .results-actions {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        /* ===== DIVIDENDS ===== */
        .dividend-controls {
            background: var(--white);
            padding: 25px;
            border-radius: var(--radius);
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 25px;
            box-shadow: var(--shadow);
        }
        
        .value-display {
            padding: 12px 20px;
            background: var(--light);
            border-radius: var(--radius);
            font-size: 1.2rem;
            font-weight: 600;
            text-align: center;
        }
        
        .value-display.profit {
            background: var(--profit-light);
            color: var(--profit);
        }
        
        .summary-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        /* ===== SETTINGS ===== */
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
        }
        
        .settings-card {
            background: var(--white);
            border-radius: var(--radius);
            padding: 25px;
            box-shadow: var(--shadow);
        }
        
        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .sync-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .sync-btn {
            padding: 15px;
            background: var(--light);
            border: 1px solid var(--border);
            border-radius: var(--radius);
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }
        
        .sync-btn:hover {
            background: var(--profit-light);
            border-color: var(--profit);
        }
        
        .sync-status {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: var(--light);
            border-radius: var(--radius);
        }
        
        .status-label {
            font-weight: 500;
        }
        
        .status-value {
            font-weight: 500;
        }
        
        .status-badge.connected {
            background: var(--profit);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .status-badge.disconnected {
            background: var(--loss);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .status-badge.syncing {
            background: var(--warning);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
        }
        
        .data-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .backup-info {
            padding: 15px;
            background: var(--light);
            border-radius: var(--radius);
            border-left: 4px solid var(--profit);
        }
        
        .backup-info i {
            color: var(--profit);
            margin-right: 10px;
        }
        
        /* ===== MODALS ===== */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .modal-content {
            background: var(--white);
            border-radius: var(--radius-lg);
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
        }
        
        .modal-header {
            padding: 25px;
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h3 {
            color: var(--primary);
        }
        
        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--secondary);
        }
        
        .close-modal:hover {
            color: var(--primary);
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid var(--border);
            display: flex;
            gap: 15px;
            justify-content: flex-end;
        }
        
        /* ===== GOOGLE SHEETS CONFIG ===== */
        .sheet-config {
            padding: 20px;
            background: var(--light);
            border-radius: var(--radius);
            margin-bottom: 20px;
        }
        
        .sheet-url-help {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--google-blue);
            color: white;
            border-radius: var(--radius);
            margin-bottom: 15px;
        }
        
        .sheet-url-help i {
            font-size: 1.2rem;
        }
        
        .sheet-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .sheet-test-results {
            margin-top: 15px;
            padding: 15px;
            background: var(--white);
            border-radius: var(--radius);
            border: 1px solid var(--border);
        }
        
        .sheet-test-success {
            color: var(--profit);
        }
        
        .sheet-test-error {
            color: var(--loss);
        }
        
        .auto-sync-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .auto-sync-option {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: var(--light);
            border-radius: var(--radius);
        }
        
        /* ===== LOADER ===== */
        #global-loader {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(3px);
        }
        
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--profit-light);
            border-top: 5px solid var(--profit);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ===== NOTIFICATIONS ===== */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 9999;
            animation: slideIn 0.3s ease-out;
            box-shadow: var(--shadow-lg);
            max-width: 400px;
        }
        
        .notification.success {
            background: var(--profit);
            color: white;
        }
        
        .notification.error {
            background: var(--loss);
            color: white;
        }
        
        .notification.warning {
            background: var(--warning);
            color: white;
        }
        
        .notification.info {
            background: var(--google-blue);
            color: white;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* ===== CLEAR DATA MODAL STYLES ===== */
        .confirmation-modal .modal-content {
            max-width: 500px;
        }
        
        .confirmation-modal .modal-body {
            text-align: center;
            padding: 30px;
        }
        
        .confirmation-modal .warning-icon {
            font-size: 4rem;
            color: var(--loss);
            margin-bottom: 20px;
        }
        
        .confirmation-modal h3 {
            color: var(--loss);
            margin-bottom: 15px;
        }
        
        .confirmation-modal .warning-box {
            background: var(--loss-light);
            padding: 15px;
            border-radius: var(--radius);
            margin: 20px 0;
            border-left: 4px solid var(--loss);
        }
        
        .confirmation-modal .warning-box i {
            color: var(--loss);
            margin-right: 10px;
        }
        
        .confirmation-modal #confirm-delete-input,
        .confirmation-modal #confirm-import-input {
            width: 100%;
            padding: 12px;
            margin: 15px 0;
            text-align: center;
            font-weight: bold;
            border: 2px solid var(--border);
            border-radius: var(--radius);
            transition: all 0.3s;
        }
        
        .confirmation-modal #confirm-delete-input:focus,
        .confirmation-modal #confirm-import-input:focus {
            border-color: var(--loss);
            box-shadow: 0 0 0 3px var(--loss-light);
        }
        
        .confirmation-modal #confirm-delete-input.correct,
        .confirmation-modal #confirm-import-input.correct {
            border-color: var(--profit);
            background: var(--profit-light);
        }
        
        /* ===== FOOTER ===== */
        .main-footer {
            background: var(--white);
            border-top: 1px solid var(--border);
            margin-top: 50px;
            padding: 30px 0;
        }
        
        .footer-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 30px;
        }
        
        .footer-logo {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--profit);
        }
        
        .footer-links {
            display: flex;
            gap: 25px;
        }
        
        .footer-links a {
            color: var(--secondary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: color 0.3s;
        }
        
        .footer-links a:hover {
            color: var(--profit);
        }
        
        .footer-info {
            text-align: right;
            color: var(--secondary);
            font-size: 0.9rem;
        }
        
        /* ===== UTILITY CLASSES ===== */
        .profit {
            color: var(--profit) !important;
        }
        
        .loss {
            color: var(--loss) !important;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-20 {
            margin-bottom: 20px;
        }
        
        .mt-20 {
            margin-top: 20px;
        }
        
        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .main-header {
                flex-direction: column;
                text-align: center;
            }
            
            .header-stats {
                width: 100%;
                justify-content: center;
            }
            
            .tab-btn {
                min-width: 120px;
            }
            
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .summary-grid {
                grid-template-columns: 1fr;
            }
            
            .actions-grid {
                grid-template-columns: 1fr;
            }
            
            .results-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                flex-direction: column;
                text-align: center;
            }
            
            .footer-info {
                text-align: center;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .main-header {
                padding: 20px;
            }
            
            .logo h1 {
                font-size: 2rem;
            }
            
            .header-stats {
                flex-direction: column;
                gap: 15px;
            }
            
            .tab-btn {
                min-width: 100%;
            }
            
            .results-grid {
                grid-template-columns: 1fr;
            }
            
            .dividend-controls {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Global Loader -->
    <div id="global-loader">
        <div class="spinner"></div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="main-header">
            <div class="logo">
                <i class="fas fa-cookie-bite"></i>
                <div>
                    <h1 id="business-title">Solo's Snacks</h1>
                    <p class="subtitle">Stock-Based Financial Management System</p>
                </div>
            </div>
            <div class="header-stats">
                <div class="stat-item">
                    <span class="stat-label">Current Round</span>
                    <span class="stat-value" id="current-round-display">Round 1</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Round Profit</span>
                    <span class="stat-value profit" id="current-profit">₵0.00</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Google Sheets</span>
                    <span class="status-badge" id="header-sync-status">Not Connected</span>
                </div>
            </div>
        </header>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="shareholder-count">0</div>
                    <div class="stat-title">Shareholders</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-boxes"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number" id="product-count">0</div>
                    <div class="stat-title">Products</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number loss" id="total-procurement">₵0.00</div>
                    <div class="stat-title">Procurement</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-chart-line"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-number profit" id="dividend-pool">₵0.00</div>
                    <div class="stat-title">Dividend Pool</div>
                </div>
            </div>
        </div>

        <!-- Navigation Tabs -->
        <nav class="main-tabs">
            <button class="tab-btn active" data-tab="dashboard">
                <i class="fas fa-home"></i> Dashboard
            </button>
            <button class="tab-btn" data-tab="products">
                <i class="fas fa-box-open"></i> Products
            </button>
            <button class="tab-btn" data-tab="procurement">
                <i class="fas fa-shopping-cart"></i> Procurement
            </button>
            <button class="tab-btn" data-tab="stock">
                <i class="fas fa-clipboard-check"></i> Stock Taking
            </button>
            <button class="tab-btn" data-tab="shareholders">
                <i class="fas fa-users"></i> Shareholders
            </button>
            <button class="tab-btn" data-tab="dividends">
                <i class="fas fa-chart-pie"></i> Dividends
            </button>
            <button class="tab-btn" data-tab="settings">
                <i class="fas fa-cog"></i> Settings
            </button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="tab-header">
                <h2><i class="fas fa-home"></i> Dashboard</h2>
                <div class="round-selector">
                    <span>Viewing:</span>
                    <select id="dashboard-round-selector">
                        <option value="1">Round 1 - Current</option>
                    </select>
                </div>
            </div>

            <div class="dashboard-grid">
                <div class="dashboard-card summary-card">
                    <h3><i class="fas fa-chart-bar"></i> Round Summary</h3>
                    <div class="summary-grid">
                        <div class="summary-item">
                            <div class="summary-label">Total Procurement</div>
                            <div class="summary-value loss" id="summary-procurement">₵0.00</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Total Sales</div>
                            <div class="summary-value profit" id="summary-sales">₵0.00</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Net Profit</div>
                            <div class="summary-value profit" id="summary-profit">₵0.00</div>
                        </div>
                        <div class="summary-item">
                            <div class="summary-label">Profit Margin</div>
                            <div class="summary-value profit" id="summary-margin">0%</div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card quick-actions">
                    <h3><i class="fas fa-bolt"></i> Quick Actions</h3>
                    <div class="actions-grid">
                        <button class="action-btn" id="quick-stock-count">
                            <i class="fas fa-clipboard-list"></i>
                            <span>Take Stock Count</span>
                        </button>
                        <button class="action-btn" id="quick-procurement">
                            <i class="fas fa-cart-plus"></i>
                            <span>Record Purchase</span>
                        </button>
                        <button class="action-btn" id="quick-dividend">
                            <i class="fas fa-calculator"></i>
                            <span>Calculate Dividends</span>
                        </button>
                        <button class="action-btn" id="quick-sync">
                            <i class="fas fa-sync-alt"></i>
                            <span>Sync to Google Sheets</span>
                        </button>
                    </div>
                </div>

                <div class="dashboard-card recent-activity">
                    <h3><i class="fas fa-history"></i> Recent Activity</h3>
                    <div class="activity-list" id="activity-list">
                        <div class="activity-item profit">
                            <i class="fas fa-info-circle"></i>
                            <div class="activity-content">
                                <div class="activity-title">Welcome!</div>
                                <div class="activity-desc">Add your first product or shareholder to get started</div>
                                <div class="activity-time">Just now</div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="dashboard-card top-products">
                    <h3><i class="fas fa-star"></i> Top Performing Products</h3>
                    <div class="products-list" id="top-products-list">
                        <div class="product-item profit">
                            <div class="product-name">No products yet</div>
                            <div class="product-stats">
                                <span class="product-sales">Add your first product</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Tab -->
        <div id="products" class="tab-content">
            <div class="tab-header">
                <h2><i class="fas fa-box-open"></i> Product Management</h2>
                <button class="btn btn-success" id="add-product-btn">
                    <i class="fas fa-plus-circle"></i> Add Product
                </button>
            </div>

            <div class="form-card">
                <h3><i class="fas fa-plus"></i> Add New Product</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="product-name">Product Name *</label>
                        <input type="text" id="product-name" placeholder="Enter product name" maxlength="100">
                    </div>
                    <div class="form-group">
                        <label for="items-per-box">Items per Box *</label>
                        <input type="number" id="items-per-box" placeholder="e.g. 24" min="1">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="cost-per-box">Cost per Box (₵) *</label>
                        <input type="number" id="cost-per-box" placeholder="e.g. 45.00" step="0.01" min="0">
                    </div>
                    <div class="form-group">
                        <label for="selling-price">Selling Price per Item (₵) *</label>
                        <input type="number" id="selling-price" placeholder="e.g. 3.00" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="initial-stock">Initial Stock (Boxes) *</label>
                        <input type="number" id="initial-stock" placeholder="e.g. 10" min="0">
                    </div>
                    <div class="form-group">
                        <label>&nbsp;</label>
                        <button class="btn btn-primary" id="save-product-btn">
                            <i class="fas fa-save"></i> Save Product
                        </button>
                        <button class="btn btn-warning" id="clear-product-form" style="margin-left: 10px;">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <small class="form-text">* Required fields</small>
                    </div>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3><i class="fas fa-list"></i> Product Inventory</h3>
                    <div class="table-actions">
                        <button class="btn btn-sm" id="refresh-products">
                            <i class="fas fa-sync"></i> Refresh
                        </button>
                        <button class="btn btn-sm btn-success" id="export-products">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                        <button class="btn btn-sm btn-google" id="sync-products-sheet">
                            <i class="fas fa-sync-alt"></i> Sync to Sheets
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Items/Box</th>
                                <th>Cost/Box</th>
                                <th>Current Stock</th>
                                <th>Selling Price</th>
                                <th>Profit/Item</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="products-table-body">
                            <!-- Products loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Procurement Tab -->
        <div id="procurement" class="tab-content">
            <div class="tab-header">
                <h2><i class="fas fa-shopping-cart"></i> Procurement Management</h2>
                <button class="btn btn-success" id="add-procurement-btn">
                    <i class="fas fa-cart-plus"></i> Add Purchase
                </button>
            </div>

            <div class="form-card">
                <h3><i class="fas fa-plus"></i> Record New Purchase</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="procurement-round">Business Round *</label>
                        <select id="procurement-round">
                            <option value="1">Round 1</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="procurement-product">Product *</label>
                        <select id="procurement-product">
                            <option value="">Select a product</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="procurement-qty">Quantity (Boxes) *</label>
                        <input type="number" id="procurement-qty" placeholder="Number of boxes" min="1">
                    </div>
                    <div class="form-group">
                        <label for="procurement-cost">Total Cost (₵) *</label>
                        <input type="number" id="procurement-cost" placeholder="Total amount" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="procurement-date">Purchase Date *</label>
                        <input type="date" id="procurement-date">
                    </div>
                    <div class="form-group">
                        <label for="procurement-supplier">Supplier *</label>
                        <input type="text" id="procurement-supplier" placeholder="Supplier name" maxlength="100">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="procurement-notes">Notes</label>
                        <textarea id="procurement-notes" placeholder="Additional notes" rows="2" maxlength="500"></textarea>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <button class="btn btn-primary" id="save-procurement-btn">
                            <i class="fas fa-save"></i> Save Purchase
                        </button>
                        <button class="btn btn-warning" id="clear-procurement-form" style="margin-left: 10px;">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3><i class="fas fa-history"></i> Purchase History</h3>
                    <div class="table-actions">
                        <button class="btn btn-sm" id="filter-procurement">
                            <i class="fas fa-filter"></i> Filter
                        </button>
                        <button class="btn btn-sm btn-success" id="export-procurement">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                        <button class="btn btn-sm btn-google" id="sync-procurement-sheet">
                            <i class="fas fa-sync-alt"></i> Sync to Sheets
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Round</th>
                                <th>Product</th>
                                <th>Qty (Box)</th>
                                <th>Cost (₵)</th>
                                <th>Supplier</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="procurement-table-body">
                            <!-- Procurement records loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Stock Taking Tab -->
        <div id="stock" class="tab-content">
            <div class="tab-header">
                <h2><i class="fas fa-clipboard-check"></i> Stock Taking</h2>
                <button class="btn btn-success" id="start-stock-btn">
                    <i class="fas fa-play-circle"></i> Start New Count
                </button>
            </div>

            <div class="stock-controls">
                <div class="control-group">
                    <label for="stock-round">Round</label>
                    <select id="stock-round">
                        <option value="1">Round 1</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="stock-date">Count Date</label>
                    <input type="date" id="stock-date">
                </div>
                <div class="control-group">
                    <label for="stock-notes">Notes</label>
                    <input type="text" id="stock-notes" placeholder="e.g., End of month count" maxlength="200">
                </div>
            </div>

            <div class="stock-count-form" id="stock-count-form" style="display: none;">
                <div class="form-header">
                    <h3><i class="fas fa-list-check"></i> Record Stock Counts</h3>
                    <div class="form-actions">
                        <button class="btn btn-sm" id="auto-fill-stock">
                            <i class="fas fa-magic"></i> Auto-Fill
                        </button>
                    </div>
                </div>
                <div class="stock-items-container" id="stock-items-container">
                    <!-- Stock items loaded by JavaScript -->
                </div>
                <div class="form-actions">
                    <button class="btn btn-success" id="calculate-stock-btn">
                        <i class="fas fa-calculator"></i> Calculate Results
                    </button>
                    <button class="btn" id="cancel-stock-btn">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
            </div>

            <div class="stock-results" id="stock-results" style="display: none;">
                <h3><i class="fas fa-chart-bar"></i> Sales Calculation Results</h3>
                <div class="results-grid">
                    <div class="result-card profit">
                        <div class="result-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="result-content">
                            <div class="result-value" id="result-items-sold">0</div>
                            <div class="result-label">Items Sold</div>
                        </div>
                    </div>
                    <div class="result-card profit">
                        <div class="result-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="result-content">
                            <div class="result-value" id="result-revenue">₵0</div>
                            <div class="result-label">Sales Revenue</div>
                        </div>
                    </div>
                    <div class="result-card loss">
                        <div class="result-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="result-content">
                            <div class="result-value" id="result-cost">₵0</div>
                            <div class="result-label">Cost of Sales</div>
                        </div>
                    </div>
                    <div class="result-card profit">
                        <div class="result-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="result-content">
                            <div class="result-value" id="result-profit">₵0</div>
                            <div class="result-label">Net Profit</div>
                        </div>
                    </div>
                </div>
                <div class="results-actions">
                    <button class="btn btn-success" id="save-stock-btn">
                        <i class="fas fa-save"></i> Save Stock Count
                    </button>
                    <button class="btn btn-google" id="sync-stock-sheet">
                        <i class="fas fa-sync-alt"></i> Sync to Sheets
                    </button>
                    <button class="btn" id="new-stock-btn">
                        <i class="fas fa-redo"></i> Start New Count
                    </button>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3><i class="fas fa-history"></i> Stock Count History</h3>
                    <div class="table-actions">
                        <button class="btn btn-sm btn-google" id="sync-stock-history-sheet">
                            <i class="fas fa-sync-alt"></i> Sync to Sheets
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Round</th>
                                <th>Items Counted</th>
                                <th>Items Sold</th>
                                <th>Revenue</th>
                                <th>Profit</th>
                                <th>Notes</th>
                            </tr>
                        </thead>
                        <tbody id="stock-history-body">
                            <!-- Stock history loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Shareholders Tab -->
        <div id="shareholders" class="tab-content">
            <div class="tab-header">
                <h2><i class="fas fa-users"></i> Shareholder Management</h2>
                <button class="btn btn-success" id="add-shareholder-btn">
                    <i class="fas fa-user-plus"></i> Add Shareholder
                </button>
            </div>

            <div class="form-card">
                <h3><i class="fas fa-plus"></i> Add New Shareholder</h3>
                <div class="form-row">
                    <div class="form-group">
                        <label for="shareholder-name">Full Name *</label>
                        <input type="text" id="shareholder-name" placeholder="Enter full name" maxlength="100">
                    </div>
                    <div class="form-group">
                        <label for="shareholder-email">Email Address *</label>
                        <input type="email" id="shareholder-email" placeholder="email@example.com" maxlength="100">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="shareholder-phone">Phone Number *</label>
                        <input type="text" id="shareholder-phone" placeholder="024-123-4567" maxlength="20">
                    </div>
                    <div class="form-group">
                        <label for="shareholder-investment">Investment Amount (₵) *</label>
                        <input type="number" id="shareholder-investment" placeholder="e.g., 2000" step="0.01" min="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Share Percentage</label>
                        <input type="text" id="shareholder-percentage" placeholder="Auto-calculated" readonly>
                    </div>
                    <div class="form-group">
                        <button class="btn btn-primary" id="save-shareholder-btn">
                            <i class="fas fa-save"></i> Save Shareholder
                        </button>
                        <button class="btn btn-warning" id="clear-shareholder-form" style="margin-left: 10px;">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3><i class="fas fa-users"></i> Shareholder List</h3>
                    <div class="table-actions">
                        <button class="btn btn-sm btn-success" id="calculate-shares">
                            <i class="fas fa-calculator"></i> Update Shares
                        </button>
                        <button class="btn btn-sm btn-google" id="sync-shareholders-sheet">
                            <i class="fas fa-sync-alt"></i> Sync to Sheets
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Contact</th>
                                <th>Investment (₵)</th>
                                <th>Share %</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="shareholders-table-body">
                            <!-- Shareholders loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Dividends Tab -->
        <div id="dividends" class="tab-content">
            <div class="tab-header">
                <h2><i class="fas fa-chart-pie"></i> Dividend Management</h2>
                <button class="btn btn-success" id="calculate-dividends-btn">
                    <i class="fas fa-calculator"></i> Calculate Dividends
                </button>
            </div>

            <div class="dividend-controls">
                <div class="control-group">
                    <label for="dividend-round">Select Round</label>
                    <select id="dividend-round">
                        <option value="1">Round 1</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="dividend-percentage">Distribution %</label>
                    <select id="dividend-percentage">
                        <option value="100">100% of profit</option>
                        <option value="80">80% of profit</option>
                        <option value="70">70% of profit</option>
                        <option value="60">60% of profit</option>
                        <option value="50">50% of profit</option>
                    </select>
                </div>
                <div class="control-group">
                    <label>Round Profit</label>
                    <div class="value-display profit" id="round-profit-display">₵0.00</div>
                </div>
                <div class="control-group">
                    <label>Dividend Pool</label>
                    <div class="value-display profit" id="dividend-pool-display">₵0.00</div>
                </div>
            </div>

            <div class="data-table">
                <div class="table-header">
                    <h3><i class="fas fa-money-check-alt"></i> Dividend Distribution</h3>
                    <div class="table-actions">
                        <button class="btn btn-sm btn-success" id="declare-dividends">
                            <i class="fas fa-flag"></i> Declare Dividends
                        </button>
                        <button class="btn btn-sm" id="export-dividends">
                            <i class="fas fa-file-export"></i> Export
                        </button>
                        <button class="btn btn-sm btn-google" id="sync-dividends-sheet">
                            <i class="fas fa-sync-alt"></i> Sync to Sheets
                        </button>
                    </div>
                </div>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Shareholder</th>
                                <th>Investment</th>
                                <th>Share %</th>
                                <th>Dividend (₵)</th>
                                <th>ROI</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="dividends-table-body">
                            <!-- Dividends loaded by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="summary-card">
                <h3><i class="fas fa-chart-bar"></i> Dividend Summary</h3>
                <div class="summary-grid">
                    <div class="summary-item">
                        <div class="summary-label">Total Investment</div>
                        <div class="summary-value" id="total-investment">₵0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Total Profit</div>
                        <div class="summary-value profit" id="total-profit">₵0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Dividend Pool</div>
                        <div class="summary-value profit" id="total-dividend-pool">₵0.00</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-label">Average ROI</div>
                        <div class="summary-value profit" id="average-roi">0%</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <div class="tab-header">
                <h2><i class="fas fa-cog"></i> System Settings</h2>
            </div>

            <div class="settings-grid">
                <div class="settings-card">
                    <h3><i class="fas fa-google"></i> Google Sheets Integration</h3>
                    <div class="sheet-config">
                        <div class="sheet-url-help">
                            <i class="fas fa-info-circle"></i>
                            <span>Get your Google Sheet ID from the URL: https://docs.google.com/spreadsheets/d/<strong>YOUR_SHEET_ID</strong>/edit</span>
                        </div>
                        
                        <div class="settings-form">
                            <div class="form-group">
                                <label for="sheet-id">Google Sheet ID *</label>
                                <input type="text" id="sheet-id" placeholder="Enter your Google Sheet ID" maxlength="100">
                                <small>This is required for automatic data recording</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="api-key">API Key (Optional)</label>
                                <input type="password" id="api-key" placeholder="Enter API key for advanced features" maxlength="200">
                                <small>Required for automatic sync and background updates</small>
                            </div>
                            
                            <div class="form-group">
                                <label for="auto-sync">Auto-Sync Settings</label>
                                <div class="auto-sync-options">
                                    <label class="auto-sync-option">
                                        <input type="checkbox" id="auto-sync-products" checked>
                                        <span>Sync products automatically</span>
                                    </label>
                                    <label class="auto-sync-option">
                                        <input type="checkbox" id="auto-sync-procurement" checked>
                                        <span>Sync purchases automatically</span>
                                    </label>
                                    <label class="auto-sync-option">
                                        <input type="checkbox" id="auto-sync-stock" checked>
                                        <span>Sync stock counts automatically</span>
                                    </label>
                                    <label class="auto-sync-option">
                                        <input type="checkbox" id="auto-sync-dividends" checked>
                                        <span>Sync dividends automatically</span>
                                    </label>
                                </div>
                            </div>
                            
                            <div class="sheet-actions">
                                <button class="btn btn-google" id="connect-sheets">
                                    <i class="fab fa-google"></i> Connect to Google Sheets
                                </button>
                                <button class="btn btn-success" id="test-sheet-connection">
                                    <i class="fas fa-test-tube"></i> Test Connection
                                </button>
                                <button class="btn btn-warning" id="create-sheet-template">
                                    <i class="fas fa-file-excel"></i> Create Template
                                </button>
                            </div>
                            
                            <div id="sheet-test-results" class="sheet-test-results" style="display: none;">
                                <!-- Test results will appear here -->
                            </div>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <h3><i class="fas fa-sync-alt"></i> Data Sync</h3>
                    <div class="sync-controls">
                        <button class="sync-btn" id="sync-all">
                            <i class="fas fa-sync"></i> Sync All Data
                        </button>
                        <button class="sync-btn" id="sync-products">
                            <i class="fas fa-boxes"></i> Sync Products
                        </button>
                        <button class="sync-btn" id="sync-procurement">
                            <i class="fas fa-shopping-cart"></i> Sync Procurement
                        </button>
                        <button class="sync-btn" id="sync-shareholders">
                            <i class="fas fa-users"></i> Sync Shareholders
                        </button>
                        <button class="sync-btn" id="sync-dividends">
                            <i class="fas fa-chart-pie"></i> Sync Dividends
                        </button>
                    </div>
                    <div class="sync-status">
                        <div class="status-item">
                            <span class="status-label">Last Sync:</span>
                            <span class="status-value" id="last-sync">Never</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Connection:</span>
                            <span class="status-badge disconnected" id="connection-status">Disconnected</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Auto-Sync:</span>
                            <span class="status-value" id="auto-sync-status">Disabled</span>
                        </div>
                    </div>
                </div>

                <div class="settings-card">
                    <h3><i class="fas fa-database"></i> Data Management</h3>
                    <div class="data-controls" id="data-controls">
                        <button class="btn btn-sm" id="export-all">
                            <i class="fas fa-download"></i> Export All Data
                        </button>
                        <button class="btn btn-sm" id="import-data">
                            <i class="fas fa-upload"></i> Import Data
                        </button>
                        <button class="btn btn-sm btn-success" id="create-backup">
                            <i class="fas fa-download"></i> Create Backup
                        </button>
                        <button class="btn btn-sm btn-warning" id="load-sample-data">
                            <i class="fas fa-vial"></i> Load Sample Data
                        </button>
                        <button class="btn btn-sm btn-danger" id="clear-data">
                            <i class="fas fa-trash"></i> Clear All Data
                        </button>
                    </div>
                    <div class="backup-info">
                        <p><i class="fas fa-info-circle"></i> Data is automatically recorded to Google Sheets when connected. Regular local backups are recommended.</p>
                    </div>
                </div>

                <div class="settings-card">
                    <h3><i class="fas fa-business-time"></i> Business Settings</h3>
                    <div class="settings-form">
                        <div class="form-group">
                            <label for="business-name">Business Name</label>
                            <input type="text" id="business-name" value="Solo's Snacks" maxlength="100">
                        </div>
                        <div class="form-group">
                            <label for="currency">Currency</label>
                            <select id="currency">
                                <option value="₵">Ghana Cedis (₵)</option>
                                <option value="$">US Dollars ($)</option>
                                <option value="€">Euros (€)</option>
                                <option value="£">British Pounds (£)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="tax-rate">Tax Rate (%)</label>
                            <input type="number" id="tax-rate" value="0" step="0.1" min="0" max="100">
                        </div>
                        <div class="form-group">
                            <label for="sync-interval">Auto-Sync Interval (minutes)</label>
                            <select id="sync-interval">
                                <option value="5">5 minutes</option>
                                <option value="15" selected>15 minutes</option>
                                <option value="30">30 minutes</option>
                                <option value="60">60 minutes</option>
                                <option value="0">Manual only</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="save-settings">
                            <i class="fas fa-save"></i> Save Settings
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Google Sheets Setup Modal -->
        <div id="sheet-setup-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fab fa-google"></i> Google Sheets Setup</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <i class="fab fa-google-drive" style="font-size: 3rem; color: var(--google-blue); margin-bottom: 15px;"></i>
                        <h3 style="margin-bottom: 10px;">Connect to Google Sheets</h3>
                        <p style="color: var(--secondary); margin-bottom: 20px;">Set up automatic data recording to Google Sheets</p>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-sheet-id">Google Sheet ID *</label>
                        <input type="text" id="modal-sheet-id" placeholder="Paste your Google Sheet ID here" style="font-family: monospace;">
                        <small class="form-text">Get this from your Google Sheet URL: docs.google.com/spreadsheets/d/<strong>YOUR_SHEET_ID</strong>/edit</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="modal-sheet-name">Sheet Name (Optional)</label>
                        <input type="text" id="modal-sheet-name" placeholder="e.g., Financial Data" value="Solo's Snacks Data">
                        <small class="form-text">Name of the sheet where data will be recorded</small>
                    </div>
                    
                    <div style="background: var(--light); padding: 15px; border-radius: var(--radius); margin: 20px 0;">
                        <h4 style="margin-bottom: 10px;"><i class="fas fa-cogs"></i> Automatic Recording Features:</h4>
                        <ul style="padding-left: 20px; color: var(--secondary);">
                            <li>All products added will be recorded automatically</li>
                            <li>All purchases will be logged in real-time</li>
                            <li>Stock counts will be saved after calculation</li>
                            <li>Dividend calculations will be recorded</li>
                            <li>Shareholder information will be updated</li>
                        </ul>
                    </div>
                    
                    <div id="sheet-setup-instructions" style="display: none;">
                        <div style="background: var(--profit-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--profit);">
                            <h4 style="color: var(--profit); margin-bottom: 10px;"><i class="fas fa-check-circle"></i> Setup Instructions:</h4>
                            <ol style="padding-left: 20px; color: var(--profit-dark);">
                                <li>Share your Google Sheet with edit permissions to: <code>your-service-account@example.com</code></li>
                                <li>Click "Test Connection" to verify setup</li>
                                <li>Data will start recording automatically</li>
                            </ol>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" id="cancel-sheet-setup">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn btn-google" id="save-sheet-setup">
                        <i class="fab fa-google"></i> Save & Connect
                    </button>
                </div>
            </div>
        </div>

        <!-- Sheet Template Modal -->
        <div id="template-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3><i class="fas fa-file-excel"></i> Create Google Sheets Template</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <div style="text-align: center; margin-bottom: 20px;">
                        <i class="fas fa-table" style="font-size: 3rem; color: var(--google-green); margin-bottom: 15px;"></i>
                        <h3 style="margin-bottom: 10px;">Create Organized Sheets</h3>
                        <p style="color: var(--secondary); margin-bottom: 20px;">This will create a Google Sheet with organized tabs for all your data</p>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <h4><i class="fas fa-layer-group"></i> Sheets to be created:</h4>
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-top: 15px;">
                            <div style="padding: 10px; background: var(--light); border-radius: var(--radius);">
                                <i class="fas fa-box" style="color: var(--profit);"></i>
                                <span style="margin-left: 10px;">Products</span>
                            </div>
                            <div style="padding: 10px; background: var(--light); border-radius: var(--radius);">
                                <i class="fas fa-shopping-cart" style="color: var(--profit);"></i>
                                <span style="margin-left: 10px;">Procurement</span>
                            </div>
                            <div style="padding: 10px; background: var(--light); border-radius: var(--radius);">
                                <i class="fas fa-users" style="color: var(--profit);"></i>
                                <span style="margin-left: 10px;">Shareholders</span>
                            </div>
                            <div style="padding: 10px; background: var(--light); border-radius: var(--radius);">
                                <i class="fas fa-chart-pie" style="color: var(--profit);"></i>
                                <span style="margin-left: 10px;">Dividends</span>
                            </div>
                            <div style="padding: 10px; background: var(--light); border-radius: var(--radius);">
                                <i class="fas fa-clipboard-check" style="color: var(--profit);"></i>
                                <span style="margin-left: 10px;">Stock History</span>
                            </div>
                            <div style="padding: 10px; background: var(--light); border-radius: var(--radius);">
                                <i class="fas fa-chart-bar" style="color: var(--profit);"></i>
                                <span style="margin-left: 10px;">Dashboard</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: var(--warning-light); padding: 15px; border-radius: var(--radius); border-left: 4px solid var(--warning);">
                        <h4 style="color: var(--warning); margin-bottom: 10px;"><i class="fas fa-exclamation-triangle"></i> Important:</h4>
                        <p style="color: var(--warning);">This will create a new Google Sheet in your Google Drive. Make sure you're logged into the correct Google account.</p>
                    </div>
                </div>
                <div class="modal-footer">
                    <button class="btn" id="cancel-template">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                    <button class="btn btn-success" id="create-template">
                        <i class="fas fa-plus-circle"></i> Create Template
                    </button>
                </div>
            </div>
        </div>

        <!-- Modals -->
        <div id="edit-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3 id="modal-title">Edit Item</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body" id="modal-body">
                    <!-- Modal content loaded by JavaScript -->
                </div>
                <div class="modal-footer">
                    <button class="btn btn-success" id="modal-save">Save Changes</button>
                    <button class="btn" id="modal-cancel">Cancel</button>
                </div>
            </div>
        </div>

        <div id="delete-modal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>Confirm Delete</h3>
                    <button class="close-modal">&times;</button>
                </div>
                <div class="modal-body">
                    <p id="delete-message">Are you sure you want to delete this item?</p>
                </div>
                <div class="modal-footer">
                    <button class="btn btn-danger" id="confirm-delete">Delete</button>
                    <button class="btn" id="cancel-delete">Cancel</button>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="main-footer">
            <div class="footer-content">
                <div class="footer-logo">
                    <i class="fas fa-cookie-bite"></i>
                    <span id="footer-business-name">Solo's Snacks</span>
                </div>
                <div class="footer-links">
                    <a href="#" id="help-link"><i class="fas fa-question-circle"></i> Help</a>
                    <a href="#" id="docs-link"><i class="fas fa-book"></i> Documentation</a>
                    <a href="#" id="contact-link"><i class="fas fa-envelope"></i> Contact</a>
                    <a href="#" id="sheet-help-link"><i class="fab fa-google"></i> Sheets Help</a>
                </div>
                <div class="footer-info">
                    <p>Financial Management System v1.0.0</p>
                    <p>Google Sheets: <span id="footer-sync-status">Not Connected</span></p>
                    <p>Data last synced: <span id="footer-sync">Never</span></p>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // ===== APPLICATION CONFIGURATION =====
        const APP_VERSION = '1.1.0';
        const APP_NAME = "Solo's Snacks";
        const STORAGE_KEY = 'soloSnacksData_v1';
        
        // ===== APPLICATION DATA =====
        let currentData = {
            products: [],
            procurement: [],
            shareholders: [],
            stockCounts: [],
            businessRounds: [],
            settings: {},
            currentRound: 1,
            version: APP_VERSION,
            lastUpdated: null
        };

        // ===== GOOGLE SHEETS CONFIGURATION =====
        let googleSheetsConnected = false;
        let autoSyncInterval = null;

        // ===== INITIALIZATION =====
        function initializeApp() {
            console.log(`${APP_NAME} v${APP_VERSION} initializing...`);
            loadData();
            setupEventListeners();
            updateUI();
            setCurrentDate();
            showNotification('Welcome to Solo\'s Snacks Financial System!', 'success');
        }

        // ===== DATA MANAGEMENT =====
        function loadData() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    
                    // Merge with current structure
                    currentData = {
                        ...currentData,
                        ...parsed,
                        version: APP_VERSION
                    };
                    
                    console.log(`Loaded ${currentData.products.length} products, ${currentData.shareholders.length} shareholders`);
                } else {
                    // Initialize with default data
                    initializeEmptyData();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                initializeEmptyData();
            }
        }

        function initializeEmptyData() {
            currentData = {
                products: [],
                procurement: [],
                shareholders: [],
                stockCounts: [],
                businessRounds: [{
                    id: 1,
                    name: "Round 1",
                    startDate: new Date().toISOString().split('T')[0],
                    endDate: null,
                    status: 'Active',
                    procurementCost: 0,
                    salesRevenue: 0,
                    netProfit: 0,
                    dividendPool: 0
                }],
                settings: {
                    businessName: APP_NAME,
                    currency: "₵",
                    taxRate: 0,
                    googleSheetId: "",
                    apiKey: "",
                    lastSync: null,
                    autoSync: true,
                    autoSyncProducts: true,
                    autoSyncProcurement: true,
                    autoSyncStock: true,
                    autoSyncShareholders: true,
                    autoSyncDividends: true,
                    syncInterval: 15,
                    notifications: true
                },
                currentRound: 1,
                version: APP_VERSION,
                lastUpdated: new Date().toISOString()
            };
            saveData();
        }

        function saveData() {
            try {
                currentData.lastUpdated = new Date().toISOString();
                localStorage.setItem(STORAGE_KEY, JSON.stringify(currentData, null, 2));
                console.log('Data saved successfully');
                updateLastSync();
            } catch (error) {
                console.error('Error saving data:', error);
                showNotification('Error saving data', 'error');
            }
        }

        function updateLastSync() {
            const now = new Date();
            const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString();
            const lastSync = `${dateString} ${timeString}`;
            
            document.getElementById('last-sync').textContent = lastSync;
            document.getElementById('footer-sync').textContent = lastSync;
        }

        // ===== UTILITY FUNCTIONS =====
        function sanitizeInput(text) {
            if (typeof text !== 'string') return '';
            return text.trim().substring(0, 500);
        }

        function sanitizeNumber(value, defaultValue = 0, min = null, max = null) {
            const num = parseFloat(value);
            if (isNaN(num)) return defaultValue;
            
            let result = num;
            if (min !== null && result < min) result = min;
            if (max !== null && result > max) result = max;
            
            return result;
        }

        function setCurrentDate() {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('procurement-date').value = today;
            document.getElementById('stock-date').value = today;
        }

        // ===== UI UPDATES =====
        function updateUI() {
            updateProductTable();
            updateProcurementTable();
            updateShareholdersTable();
            updateStockHistory();
            updateRoundSelectors();
            updateSettingsForm();
            updateDashboard();
            updateActivityLog();
            updateTopProducts();
            
            // Set business name
            const businessName = currentData.settings.businessName || APP_NAME;
            document.getElementById('business-title').textContent = businessName;
            document.getElementById('footer-business-name').textContent = businessName;
        }

        function updateProductTable() {
            const tbody = document.getElementById('products-table-body');
            tbody.innerHTML = '';
            
            if (currentData.products.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="8" class="text-center">No products found. Add your first product!</td>`;
                tbody.appendChild(row);
                document.getElementById('product-count').textContent = '0';
                return;
            }
            
            currentData.products.forEach(product => {
                const profitPerItem = product.sellingPrice - (product.costPerBox / product.itemsPerBox);
                const status = product.currentStock <= 2 ? 'Low Stock' : 
                              product.currentStock >= 20 ? 'High Stock' : 'In Stock';
                const statusClass = product.currentStock <= 2 ? 'loss' : 
                                   product.currentStock >= 20 ? 'warning' : 'profit';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sanitizeInput(product.name)}</td>
                    <td>${product.itemsPerBox}</td>
                    <td class="${product.costPerBox > 50 ? 'loss' : ''}">₵${product.costPerBox.toFixed(2)}</td>
                    <td>${product.currentStock}</td>
                    <td class="profit">₵${product.sellingPrice.toFixed(2)}</td>
                    <td class="${profitPerItem >= 0 ? 'profit' : 'loss'}">₵${profitPerItem.toFixed(2)}</td>
                    <td><span class="${statusClass}">${status}</span></td>
                    <td>
                        <button class="btn btn-sm" onclick="editProduct(${product.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('product-count').textContent = currentData.products.length;
            updateProcurementProductDropdown();
        }

        function updateProcurementProductDropdown() {
            const select = document.getElementById('procurement-product');
            select.innerHTML = '<option value="">Select a product</option>';
            
            currentData.products.forEach(product => {
                const option = document.createElement('option');
                option.value = product.id;
                option.textContent = product.name;
                select.appendChild(option);
            });
        }

        function updateProcurementTable() {
            const tbody = document.getElementById('procurement-table-body');
            tbody.innerHTML = '';
            
            let totalCost = 0;
            
            if (currentData.procurement.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" class="text-center">No purchase records found.</td>`;
                tbody.appendChild(row);
                document.getElementById('total-procurement').textContent = '₵0.00';
                return;
            }
            
            currentData.procurement.forEach(record => {
                totalCost += record.cost;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${record.date}</td>
                    <td>Round ${record.round}</td>
                    <td>${sanitizeInput(record.productName)}</td>
                    <td>${record.quantity}</td>
                    <td class="loss">₵${record.cost.toFixed(2)}</td>
                    <td>${sanitizeInput(record.supplier)}</td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteProcurement(${record.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('total-procurement').textContent = `₵${totalCost.toFixed(2)}`;
        }

        function updateShareholdersTable() {
            const tbody = document.getElementById('shareholders-table-body');
            tbody.innerHTML = '';
            
            if (currentData.shareholders.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="6" class="text-center">No shareholders found. Add your first shareholder!</td>`;
                tbody.appendChild(row);
                document.getElementById('shareholder-count').textContent = '0';
                return;
            }
            
            const totalInvestment = currentData.shareholders.reduce((sum, s) => sum + s.investment, 0);
            
            currentData.shareholders.forEach(shareholder => {
                const sharePercentage = totalInvestment > 0 
                    ? ((shareholder.investment / totalInvestment) * 100).toFixed(1)
                    : '0.0';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sanitizeInput(shareholder.name)}</td>
                    <td>
                        <div>${sanitizeInput(shareholder.email)}</div>
                        <small>${sanitizeInput(shareholder.phone)}</small>
                    </td>
                    <td>₵${shareholder.investment.toFixed(2)}</td>
                    <td>${sharePercentage}%</td>
                    <td><span class="profit">Active</span></td>
                    <td>
                        <button class="btn btn-sm btn-danger" onclick="deleteShareholder(${shareholder.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('shareholder-count').textContent = currentData.shareholders.length;
        }

        function updateStockHistory() {
            const tbody = document.getElementById('stock-history-body');
            tbody.innerHTML = '';
            
            if (currentData.stockCounts.length === 0) {
                const row = document.createElement('tr');
                row.innerHTML = `<td colspan="7" class="text-center">No stock count history found.</td>`;
                tbody.appendChild(row);
                return;
            }
            
            currentData.stockCounts.forEach(count => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${count.date}</td>
                    <td>Round ${count.round}</td>
                    <td>${count.itemsCounted}</td>
                    <td class="profit">${count.itemsSold.toLocaleString()}</td>
                    <td class="profit">₵${count.revenue.toFixed(2)}</td>
                    <td class="${count.profit >= 0 ? 'profit' : 'loss'}">₵${count.profit.toFixed(2)}</td>
                    <td>${sanitizeInput(count.notes)}</td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateRoundSelectors() {
            const selectors = [
                'dashboard-round-selector',
                'procurement-round',
                'stock-round',
                'dividend-round'
            ];
            
            selectors.forEach(selectorId => {
                const select = document.getElementById(selectorId);
                if (select) {
                    select.innerHTML = currentData.businessRounds
                        .map(round => `<option value="${round.id}">${round.name}${round.status === 'Active' ? ' - Current' : ''}</option>`)
                        .join('');
                    select.value = currentData.currentRound;
                }
            });
        }

        function updateSettingsForm() {
            document.getElementById('business-name').value = currentData.settings.businessName || APP_NAME;
            document.getElementById('currency').value = currentData.settings.currency || "₵";
            document.getElementById('tax-rate').value = currentData.settings.taxRate || 0;
            document.getElementById('sheet-id').value = currentData.settings.googleSheetId || "";
            document.getElementById('api-key').value = currentData.settings.apiKey || "";
            document.getElementById('sync-interval').value = currentData.settings.syncInterval || 15;
            
            // Auto-sync checkboxes
            document.getElementById('auto-sync-products').checked = currentData.settings.autoSyncProducts !== false;
            document.getElementById('auto-sync-procurement').checked = currentData.settings.autoSyncProcurement !== false;
            document.getElementById('auto-sync-stock').checked = currentData.settings.autoSyncStock !== false;
            document.getElementById('auto-sync-dividends').checked = currentData.settings.autoSyncDividends !== false;
            
            if (currentData.settings.lastSync) {
                document.getElementById('last-sync').textContent = currentData.settings.lastSync;
                document.getElementById('footer-sync').textContent = currentData.settings.lastSync;
            }
        }

        function updateDashboard() {
            const currentRound = currentData.businessRounds.find(r => r.id === currentData.currentRound);
            if (!currentRound) return;
            
            // Update main stats
            document.getElementById('current-round-display').textContent = currentRound.name;
            document.getElementById('current-profit').textContent = `₵${currentRound.netProfit.toFixed(2)}`;
            document.getElementById('total-procurement').textContent = `₵${currentRound.procurementCost.toFixed(2)}`;
            document.getElementById('dividend-pool').textContent = `₵${currentRound.dividendPool.toFixed(2)}`;
            
            // Calculate profit margin
            const profitMargin = currentRound.salesRevenue > 0 
                ? ((currentRound.netProfit / currentRound.salesRevenue) * 100).toFixed(1)
                : '0.0';
            
            // Update summary
            document.getElementById('summary-procurement').textContent = `₵${currentRound.procurementCost.toFixed(2)}`;
            document.getElementById('summary-sales').textContent = `₵${currentRound.salesRevenue.toFixed(2)}`;
            document.getElementById('summary-profit').textContent = `₵${currentRound.netProfit.toFixed(2)}`;
            document.getElementById('summary-margin').textContent = `${profitMargin}%`;
        }

        function updateActivityLog() {
            const activityList = document.getElementById('activity-list');
            activityList.innerHTML = '';
            
            if (currentData.products.length === 0 && currentData.shareholders.length === 0) {
                const welcomeItem = document.createElement('div');
                welcomeItem.className = 'activity-item profit';
                welcomeItem.innerHTML = `
                    <i class="fas fa-info-circle"></i>
                    <div class="activity-content">
                        <div class="activity-title">Welcome!</div>
                        <div class="activity-desc">Add your first product or shareholder to get started</div>
                        <div class="activity-time">Just now</div>
                    </div>
                `;
                activityList.appendChild(welcomeItem);
                return;
            }
            
            // Add recent activities
            if (currentData.products.length > 0) {
                const recentProduct = currentData.products[currentData.products.length - 1];
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item profit';
                activityItem.innerHTML = `
                    <i class="fas fa-box-open"></i>
                    <div class="activity-content">
                        <div class="activity-title">Product Added</div>
                        <div class="activity-desc">${recentProduct.name}</div>
                        <div class="activity-time">Recently</div>
                    </div>
                `;
                activityList.appendChild(activityItem);
            }
            
            if (currentData.shareholders.length > 0) {
                const recentShareholder = currentData.shareholders[currentData.shareholders.length - 1];
                const activityItem = document.createElement('div');
                activityItem.className = 'activity-item profit';
                activityItem.innerHTML = `
                    <i class="fas fa-user-plus"></i>
                    <div class="activity-content">
                        <div class="activity-title">Shareholder Added</div>
                        <div class="activity-desc">${recentShareholder.name}</div>
                        <div class="activity-time">Recently</div>
                    </div>
                `;
                activityList.appendChild(activityItem);
            }
        }

        function updateTopProducts() {
            const topProductsList = document.getElementById('top-products-list');
            topProductsList.innerHTML = '';
            
            if (currentData.products.length === 0) {
                const productItem = document.createElement('div');
                productItem.className = 'product-item profit';
                productItem.innerHTML = `
                    <div class="product-name">No products yet</div>
                    <div class="product-stats">
                        <span class="product-sales">Add your first product</span>
                    </div>
                `;
                topProductsList.appendChild(productItem);
                return;
            }
            
            // Sort products by current stock
            const sortedProducts = [...currentData.products]
                .sort((a, b) => b.currentStock - a.currentStock)
                .slice(0, 3);
            
            sortedProducts.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = `product-item ${product.currentStock <= 2 ? 'loss' : 'profit'}`;
                productItem.innerHTML = `
                    <div class="product-name">${product.name}</div>
                    <div class="product-stats">
                        <span class="product-sales">${product.currentStock} boxes in stock</span>
                        <span class="product-profit">₵${product.sellingPrice.toFixed(2)}/item</span>
                    </div>
                `;
                topProductsList.appendChild(productItem);
            });
        }

        // ===== PRODUCT FUNCTIONS =====
        function addProduct() {
            const name = document.getElementById('product-name').value.trim();
            const itemsPerBox = document.getElementById('items-per-box').value;
            const costPerBox = document.getElementById('cost-per-box').value;
            const sellingPrice = document.getElementById('selling-price').value;
            const initialStock = document.getElementById('initial-stock').value;
            
            // Validation
            if (!name || !itemsPerBox || !costPerBox || !sellingPrice || !initialStock) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            if (parseFloat(costPerBox) <= 0 || parseFloat(sellingPrice) <= 0) {
                showNotification('Cost and price must be greater than 0', 'error');
                return;
            }
            
            const newId = currentData.products.length > 0 
                ? Math.max(...currentData.products.map(p => p.id)) + 1 
                : 1;
            
            const newProduct = {
                id: newId,
                name: sanitizeInput(name),
                itemsPerBox: sanitizeNumber(itemsPerBox, 1, 1),
                costPerBox: sanitizeNumber(costPerBox, 0, 0),
                sellingPrice: sanitizeNumber(sellingPrice, 0, 0),
                currentStock: sanitizeNumber(initialStock, 0, 0)
            };
            
            currentData.products.push(newProduct);
            saveData();
            updateUI();
            clearProductForm();
            showNotification('Product added successfully!', 'success');
        }

        function editProduct(id) {
            const product = currentData.products.find(p => p.id === id);
            if (!product) {
                showNotification('Product not found', 'error');
                return;
            }
            
            const modal = document.getElementById('edit-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalBody = document.getElementById('modal-body');
            
            modalTitle.textContent = 'Edit Product';
            modalBody.innerHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-product-name">Product Name</label>
                        <input type="text" id="edit-product-name" value="${sanitizeInput(product.name)}">
                    </div>
                    <div class="form-group">
                        <label for="edit-items-per-box">Items per Box</label>
                        <input type="number" id="edit-items-per-box" value="${product.itemsPerBox}">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-cost-per-box">Cost per Box (₵)</label>
                        <input type="number" id="edit-cost-per-box" value="${product.costPerBox}" step="0.01">
                    </div>
                    <div class="form-group">
                        <label for="edit-selling-price">Selling Price (₵)</label>
                        <input type="number" id="edit-selling-price" value="${product.sellingPrice}" step="0.01">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="edit-current-stock">Current Stock</label>
                        <input type="number" id="edit-current-stock" value="${product.currentStock}">
                    </div>
                </div>
                <input type="hidden" id="edit-product-id" value="${product.id}">
            `;
            
            modal.style.display = 'flex';
            
            document.getElementById('modal-save').onclick = () => {
                const updatedProduct = {
                    name: document.getElementById('edit-product-name').value,
                    itemsPerBox: parseInt(document.getElementById('edit-items-per-box').value),
                    costPerBox: parseFloat(document.getElementById('edit-cost-per-box').value),
                    sellingPrice: parseFloat(document.getElementById('edit-selling-price').value),
                    currentStock: parseInt(document.getElementById('edit-current-stock').value)
                };
                
                if (!updatedProduct.name || isNaN(updatedProduct.itemsPerBox) || isNaN(updatedProduct.costPerBox)) {
                    showNotification('Please fill all fields correctly', 'error');
                    return;
                }
                
                product.name = updatedProduct.name;
                product.itemsPerBox = updatedProduct.itemsPerBox;
                product.costPerBox = updatedProduct.costPerBox;
                product.sellingPrice = updatedProduct.sellingPrice;
                product.currentStock = updatedProduct.currentStock;
                
                saveData();
                updateUI();
                modal.style.display = 'none';
                showNotification('Product updated successfully!', 'success');
            };
            
            document.getElementById('modal-cancel').onclick = () => {
                modal.style.display = 'none';
            };
        }

        function deleteProduct(id) {
            const product = currentData.products.find(p => p.id === id);
            if (!product) return;
            
            const modal = document.getElementById('delete-modal');
            document.getElementById('delete-message').textContent = `Are you sure you want to delete "${product.name}"?`;
            modal.style.display = 'flex';
            
            document.getElementById('confirm-delete').onclick = () => {
                currentData.products = currentData.products.filter(p => p.id !== id);
                saveData();
                updateUI();
                modal.style.display = 'none';
                showNotification('Product deleted successfully!', 'success');
            };
            
            document.getElementById('cancel-delete').onclick = () => {
                modal.style.display = 'none';
            };
        }

        function clearProductForm() {
            document.getElementById('product-name').value = '';
            document.getElementById('items-per-box').value = '';
            document.getElementById('cost-per-box').value = '';
            document.getElementById('selling-price').value = '';
            document.getElementById('initial-stock').value = '';
        }

        // ===== PROCUREMENT FUNCTIONS =====
        function addProcurement() {
            const productId = document.getElementById('procurement-product').value;
            const quantity = document.getElementById('procurement-qty').value;
            const cost = document.getElementById('procurement-cost').value;
            const date = document.getElementById('procurement-date').value;
            const supplier = document.getElementById('procurement-supplier').value;
            
            // Validation
            if (!productId || !quantity || !cost || !date || !supplier) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            const product = currentData.products.find(p => p.id === parseInt(productId));
            if (!product) {
                showNotification('Product not found!', 'error');
                return;
            }
            
            const newId = currentData.procurement.length > 0 
                ? Math.max(...currentData.procurement.map(p => p.id)) + 1 
                : 1;
            
            const newProcurement = {
                id: newId,
                round: currentData.currentRound,
                date: date,
                productId: parseInt(productId),
                productName: product.name,
                quantity: sanitizeNumber(quantity, 1, 1),
                cost: sanitizeNumber(cost, 0, 0),
                supplier: sanitizeInput(supplier),
                notes: sanitizeInput(document.getElementById('procurement-notes').value)
            };
            
            // Update product stock
            product.currentStock += newProcurement.quantity;
            
            currentData.procurement.push(newProcurement);
            saveData();
            updateUI();
            clearProcurementForm();
            showNotification('Purchase recorded successfully!', 'success');
        }

        function deleteProcurement(id) {
            const procurement = currentData.procurement.find(p => p.id === id);
            if (!procurement) return;
            
            if (confirm(`Delete purchase record for ${procurement.productName}?`)) {
                currentData.procurement = currentData.procurement.filter(p => p.id !== id);
                
                // Update product stock
                const product = currentData.products.find(p => p.id === procurement.productId);
                if (product) {
                    product.currentStock = Math.max(0, product.currentStock - procurement.quantity);
                }
                
                saveData();
                updateUI();
                showNotification('Purchase record deleted', 'success');
            }
        }

        function clearProcurementForm() {
            document.getElementById('procurement-product').value = '';
            document.getElementById('procurement-qty').value = '';
            document.getElementById('procurement-cost').value = '';
            document.getElementById('procurement-date').value = new Date().toISOString().split('T')[0];
            document.getElementById('procurement-supplier').value = '';
            document.getElementById('procurement-notes').value = '';
        }

        // ===== SHAREHOLDER FUNCTIONS =====
        function addShareholder() {
            const name = document.getElementById('shareholder-name').value.trim();
            const email = document.getElementById('shareholder-email').value.trim();
            const phone = document.getElementById('shareholder-phone').value.trim();
            const investment = document.getElementById('shareholder-investment').value;
            
            // Validation
            if (!name || !email || !phone || !investment) {
                showNotification('Please fill in all required fields', 'error');
                return;
            }
            
            // Email validation
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showNotification('Please enter a valid email address', 'error');
                return;
            }
            
            const newId = currentData.shareholders.length > 0 
                ? Math.max(...currentData.shareholders.map(s => s.id)) + 1 
                : 1;
            
            const newShareholder = {
                id: newId,
                name: sanitizeInput(name),
                email: sanitizeInput(email),
                phone: sanitizeInput(phone),
                investment: sanitizeNumber(investment, 0, 0)
            };
            
            currentData.shareholders.push(newShareholder);
            saveData();
            updateUI();
            clearShareholderForm();
            showNotification('Shareholder added successfully!', 'success');
        }

        function deleteShareholder(id) {
            const shareholder = currentData.shareholders.find(s => s.id === id);
            if (!shareholder) return;
            
            if (confirm(`Delete shareholder "${shareholder.name}"? This cannot be undone.`)) {
                currentData.shareholders = currentData.shareholders.filter(s => s.id !== id);
                saveData();
                updateUI();
                showNotification('Shareholder deleted', 'success');
            }
        }

        function clearShareholderForm() {
            document.getElementById('shareholder-name').value = '';
            document.getElementById('shareholder-email').value = '';
            document.getElementById('shareholder-phone').value = '';
            document.getElementById('shareholder-investment').value = '';
            document.getElementById('shareholder-percentage').value = '';
        }

        // ===== STOCK TAKING FUNCTIONS =====
        let currentStockCount = [];

        function startStockCount() {
            const container = document.getElementById('stock-items-container');
            container.innerHTML = '';
            
            if (currentData.products.length === 0) {
                showNotification('No products found. Please add products first.', 'warning');
                return;
            }
            
            currentData.products.forEach(product => {
                const itemDiv = document.createElement('div');
                itemDiv.className = 'stock-item';
                itemDiv.innerHTML = `
                    <div class="stock-item-info">
                        <div class="stock-item-name">${product.name}</div>
                        <div class="stock-item-details">
                            <span>Current: ${product.currentStock} boxes</span>
                            <span>Price: ₵${product.sellingPrice.toFixed(2)}/item</span>
                            <span>Items/Box: ${product.itemsPerBox}</span>
                        </div>
                    </div>
                    <div class="stock-item-input">
                        <label>Counted Stock (Boxes)</label>
                        <input type="number" id="stock-count-${product.id}" 
                               value="${product.currentStock}" min="0">
                        <small class="input-hint" id="hint-${product.id}"></small>
                    </div>
                `;
                container.appendChild(itemDiv);
            });
            
            document.getElementById('stock-count-form').style.display = 'block';
            document.getElementById('stock-results').style.display = 'none';
        }

        function calculateStockResults() {
            let totalItemsSold = 0;
            let totalRevenue = 0;
            let totalCost = 0;
            
            currentStockCount = [];
            
            // Calculate results
            currentData.products.forEach(product => {
                const countedStock = parseInt(document.getElementById(`stock-count-${product.id}`).value) || 0;
                const previousStock = product.currentStock;
                
                if (countedStock < previousStock) {
                    const boxesSold = previousStock - countedStock;
                    const itemsSold = boxesSold * product.itemsPerBox;
                    const costPerItem = product.costPerBox / product.itemsPerBox;
                    const revenue = itemsSold * product.sellingPrice;
                    const cost = itemsSold * costPerItem;
                    
                    totalItemsSold += itemsSold;
                    totalRevenue += revenue;
                    totalCost += cost;
                    
                    currentStockCount.push({
                        productId: product.id,
                        countedStock: countedStock,
                        itemsSold: itemsSold,
                        revenue: revenue,
                        cost: cost,
                        productName: product.name
                    });
                }
            });
            
            const netProfit = totalRevenue - totalCost;
            
            // Update results display
            document.getElementById('result-items-sold').textContent = totalItemsSold.toLocaleString();
            document.getElementById('result-revenue').textContent = `₵${totalRevenue.toFixed(2)}`;
            document.getElementById('result-cost').textContent = `₵${totalCost.toFixed(2)}`;
            document.getElementById('result-profit').textContent = `₵${netProfit.toFixed(2)}`;
            
            // Show results
            document.getElementById('stock-count-form').style.display = 'none';
            document.getElementById('stock-results').style.display = 'block';
        }

        function saveStockCount() {
            const round = parseInt(document.getElementById('stock-round').value) || currentData.currentRound;
            const date = document.getElementById('stock-date').value || new Date().toISOString().split('T')[0];
            const notes = sanitizeInput(document.getElementById('stock-notes').value);
            
            if (currentStockCount.length === 0) {
                showNotification('No stock count data to save', 'warning');
                return;
            }
            
            // Update product stocks
            currentStockCount.forEach(item => {
                const product = currentData.products.find(p => p.id === item.productId);
                if (product) {
                    product.currentStock = item.countedStock;
                }
            });
            
            // Calculate totals
            const totalItemsSold = currentStockCount.reduce((sum, item) => sum + item.itemsSold, 0);
            const totalRevenue = currentStockCount.reduce((sum, item) => sum + item.revenue, 0);
            const totalProfit = currentStockCount.reduce((sum, item) => sum + (item.revenue - item.cost), 0);
            
            // Create stock count record
            const newStockCount = {
                id: currentData.stockCounts.length + 1,
                round: round,
                date: date,
                itemsCounted: currentData.products.length,
                itemsSold: totalItemsSold,
                revenue: totalRevenue,
                profit: totalProfit,
                notes: notes
            };
            
            currentData.stockCounts.push(newStockCount);
            
            // Update business round
            const currentRound = currentData.businessRounds.find(r => r.id === round);
            if (currentRound) {
                currentRound.salesRevenue += totalRevenue;
                currentRound.netProfit = currentRound.salesRevenue - currentRound.procurementCost;
                currentRound.dividendPool = currentRound.netProfit;
            }
            
            saveData();
            updateUI();
            
            // Reset form
            document.getElementById('stock-count-form').style.display = 'none';
            document.getElementById('stock-results').style.display = 'none';
            document.getElementById('stock-notes').value = '';
            
            showNotification('Stock count saved successfully!', 'success');
        }

        // ===== SETTINGS FUNCTIONS =====
        function saveSettings() {
            const businessName = sanitizeInput(document.getElementById('business-name').value) || APP_NAME;
            const currency = document.getElementById('currency').value;
            const taxRate = sanitizeNumber(document.getElementById('tax-rate').value, 0, 0, 100);
            const sheetId = sanitizeInput(document.getElementById('sheet-id').value);
            const apiKey = sanitizeInput(document.getElementById('api-key').value);
            const syncInterval = parseInt(document.getElementById('sync-interval').value) || 15;
            
            // Auto-sync settings
            const autoSyncProducts = document.getElementById('auto-sync-products').checked;
            const autoSyncProcurement = document.getElementById('auto-sync-procurement').checked;
            const autoSyncStock = document.getElementById('auto-sync-stock').checked;
            const autoSyncDividends = document.getElementById('auto-sync-dividends').checked;
            
            currentData.settings.businessName = businessName;
            currentData.settings.currency = currency;
            currentData.settings.taxRate = taxRate;
            currentData.settings.googleSheetId = sheetId;
            currentData.settings.apiKey = apiKey;
            currentData.settings.syncInterval = syncInterval;
            currentData.settings.autoSyncProducts = autoSyncProducts;
            currentData.settings.autoSyncProcurement = autoSyncProcurement;
            currentData.settings.autoSyncStock = autoSyncStock;
            currentData.settings.autoSyncDividends = autoSyncDividends;
            
            // Update UI
            document.getElementById('business-title').textContent = businessName;
            document.getElementById('footer-business-name').textContent = businessName;
            
            saveData();
            showNotification('Settings saved successfully!', 'success');
        }

        function exportData(type = 'all') {
            let dataToExport;
            let filename;
            
            switch(type) {
                case 'products':
                    dataToExport = currentData.products;
                    filename = `${APP_NAME}_Products_${new Date().toISOString().split('T')[0]}.json`;
                    break;
                case 'shareholders':
                    dataToExport = currentData.shareholders;
                    filename = `${APP_NAME}_Shareholders_${new Date().toISOString().split('T')[0]}.json`;
                    break;
                case 'procurement':
                    dataToExport = currentData.procurement;
                    filename = `${APP_NAME}_Procurement_${new Date().toISOString().split('T')[0]}.json`;
                    break;
                default:
                    dataToExport = currentData;
                    filename = `${APP_NAME}_FullBackup_${new Date().toISOString().split('T')[0]}.json`;
            }
            
            const dataStr = JSON.stringify(dataToExport, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const link = document.createElement('a');
            link.setAttribute('href', dataUri);
            link.setAttribute('download', filename);
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification(`Data exported to ${filename}`, 'success');
        }

        function clearAllData() {
            if (confirm('WARNING: This will delete ALL data including products, shareholders, and purchase records. This cannot be undone. Continue?')) {
                currentData = {
                    products: [],
                    procurement: [],
                    shareholders: [],
                    stockCounts: [],
                    businessRounds: [{
                        id: 1,
                        name: "Round 1",
                        startDate: new Date().toISOString().split('T')[0],
                        endDate: null,
                        status: 'Active',
                        procurementCost: 0,
                        salesRevenue: 0,
                        netProfit: 0,
                        dividendPool: 0
                    }],
                    settings: {
                        businessName: APP_NAME,
                        currency: "₵",
                        taxRate: 0,
                        googleSheetId: "",
                        apiKey: "",
                        lastSync: null,
                        autoSync: true,
                        autoSyncProducts: true,
                        autoSyncProcurement: true,
                        autoSyncStock: true,
                        autoSyncShareholders: true,
                        autoSyncDividends: true,
                        syncInterval: 15,
                        notifications: true
                    },
                    currentRound: 1,
                    version: APP_VERSION,
                    lastUpdated: new Date().toISOString()
                };
                
                saveData();
                updateUI();
                showNotification('All data has been cleared successfully!', 'success');
            }
        }

        function loadSampleData() {
            if (confirm('Load sample data? This will replace current data with example data.')) {
                currentData.products = [
                    { id: 1, name: "BIGO DRINKS", itemsPerBox: 24, costPerBox: 45.00, currentStock: 10, sellingPrice: 3.00 },
                    { id: 2, name: "MALT", itemsPerBox: 24, costPerBox: 48.00, currentStock: 8, sellingPrice: 3.50 },
                    { id: 3, name: "BEL COLA", itemsPerBox: 24, costPerBox: 42.00, currentStock: 12, sellingPrice: 2.80 }
                ];
                
                currentData.procurement = [
                    { id: 1, round: 1, date: new Date().toISOString().split('T')[0], productId: 1, productName: "BIGO DRINKS", quantity: 10, cost: 450, supplier: "Beverages Wholesale", notes: "Initial stock" }
                ];
                
                currentData.shareholders = [
                    { id: 1, name: "Kwame Solo", email: "kwame@example.com", phone: "024-123-4567", investment: 2000 },
                    { id: 2, name: "Ama Mensah", email: "ama@example.com", phone: "024-234-5678", investment: 1250 }
                ];
                
                saveData();
                updateUI();
                showNotification('Sample data loaded successfully!', 'success');
            }
        }

        // ===== NOTIFICATION SYSTEM =====
        function showNotification(message, type = 'success') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            
            let icon = 'info-circle';
            if (type === 'success') icon = 'check-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            
            notification.innerHTML = `
                <i class="fas fa-${icon}"></i>
                <span>${sanitizeInput(message)}</span>
            `;
            
            document.body.appendChild(notification);
            
            // Remove after 4 seconds
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 4000);
        }

        // ===== TAB NAVIGATION =====
        function switchTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-tab') === tabId);
            });
            
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.toggle('active', content.id === tabId);
            });
        }

        // ===== EVENT LISTENERS SETUP =====
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tabId = btn.getAttribute('data-tab');
                    switchTab(tabId);
                });
            });
            
            // Quick actions
            document.getElementById('quick-stock-count').addEventListener('click', () => switchTab('stock'));
            document.getElementById('quick-procurement').addEventListener('click', () => switchTab('procurement'));
            document.getElementById('quick-dividend').addEventListener('click', () => switchTab('dividends'));
            
            // Product form
            document.getElementById('save-product-btn').addEventListener('click', addProduct);
            document.getElementById('clear-product-form').addEventListener('click', clearProductForm);
            
            // Procurement form
            document.getElementById('save-procurement-btn').addEventListener('click', addProcurement);
            document.getElementById('clear-procurement-form').addEventListener('click', clearProcurementForm);
            
            // Shareholder form
            document.getElementById('save-shareholder-btn').addEventListener('click', addShareholder);
            document.getElementById('clear-shareholder-form').addEventListener('click', clearShareholderForm);
            
            // Stock taking
            document.getElementById('start-stock-btn').addEventListener('click', startStockCount);
            document.getElementById('calculate-stock-btn').addEventListener('click', calculateStockResults);
            document.getElementById('save-stock-btn').addEventListener('click', saveStockCount);
            
            // Settings
            document.getElementById('save-settings').addEventListener('click', saveSettings);
            document.getElementById('export-all').addEventListener('click', () => exportData('all'));
            document.getElementById('export-products').addEventListener('click', () => exportData('products'));
            document.getElementById('export-procurement').addEventListener('click', () => exportData('procurement'));
            document.getElementById('load-sample-data').addEventListener('click', loadSampleData);
            document.getElementById('clear-data').addEventListener('click', clearAllData);
            
            // Refresh buttons
            document.getElementById('refresh-products').addEventListener('click', () => {
                updateUI();
                showNotification('Products refreshed', 'success');
            });
            
            // Close modals
            document.querySelectorAll('.close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) modal.style.display = 'none';
                });
            });
            
            window.addEventListener('click', (e) => {
                if (e.target.classList.contains('modal')) {
                    e.target.style.display = 'none';
                }
            });
            
            // Help links
            document.getElementById('help-link').addEventListener('click', (e) => {
                e.preventDefault();
                showNotification('For help, please contact the system administrator.', 'info');
            });
            
            // Auto-save on page unload
            window.addEventListener('beforeunload', function(e) {
                saveData();
            });
        }

        // ===== INITIALIZE APP =====
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
